@host = http://localhost:3333
@token = REPLACE_WITH_JWT
@org = REPLACE_WITH_ORG_ID
@project = REPLACE_WITH_PROJECT_ID
@impersonate = REPLACE_WITH_IMPERSONATED_USER_ID

### Get current active context
GET {{host}}/me/context
Authorization: Bearer {{token}}
x-org-id: {{org}}
x-project-id: {{project}}
x-impersonated-user-id: {{impersonate}}

### Expected: 200
### Response shape: { actor, org, project, permissions, limits, flags, meta }

### List organizations for current user
GET {{host}}/me/orgs
Authorization: Bearer {{token}}

### List projects for org
GET {{host}}/me/projects?orgId={{org}}
Authorization: Bearer {{token}}

### Example: simulate missing org -> expect 409
# Remove x-org-id header or set to invalid id
GET {{host}}/me/context
Authorization: Bearer {{token}}

### Switch active organization (updates users.last_active_org_id)
POST {{host}}/me/switch-org
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "organizationId": "{{org}}"
}
# =====================================================
# Organizations & Projects API Test File
# =====================================================
# 
# Використовуй з VS Code REST Client extension (встанови якщо нема)
# Extension ID: humao.rest-client
# 
# =====================================================
# ЯК ОТРИМАТИ ТОКЕН (3 способи):
# =====================================================
#
# СПОСІБ 1 - Через DevTools браузера (НАЙПРОСТІШИЙ):
# 1. Відкрий фронтенд і залогінься
# 2. Відкрий DevTools (F12) → Application → Cookies
# 3. Знайди cookie "sb-access-token" або "access_token"
# 4. Скопіюй значення і встав в @token нижче
#
# СПОСІБ 2 - Через Network tab:
# 1. Відкрий DevTools (F12) → Network
# 2. Зроби будь-яку дію на сайті (наприклад відкрий сторінку)
# 3. Знайди запит до API (наприклад /auth/profile)
# 4. Подивись Headers → Authorization: Bearer <TOKEN>
# 5. Скопіюй токен (все після "Bearer ")
#
# СПОСІБ 3 - Через localStorage:
# 1. DevTools (F12) → Console
# 2. Введи: localStorage.getItem('supabase.auth.token')
# 3. Скопіюй access_token з JSON
#
# =====================================================

# === RENDER DEV SERVER ===
@baseUrl = https://back-r5ry.onrender.com

# === ВСТАВ СВІЙ ТОКЕН ТУТ ===
@token = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjJiMWRhZGRjLTc0OWYtNDNkYS05ZGE2LTQwNWJiNTFmYjVmYSIsImVtYWlsIjoid2Fyd2Fyd2FyNTZAZ21haWwuY29tIiwicm9sZSI6ImFkbWluIiwiaWF0IjoxNzY5NjEyNjUxLCJleHAiOjE3NzIyMDQ2NTF9.19I29oQZ2dt4GPtfXv4InsmIjOESR857ZM6WDFtoco8

# === Ці ID заповни після створення org/project ===
@orgId = fa0c558d-98a2-4f49-848c-c494b6b153e7
@projectId = YOUR_PROJECT_UUID

### =====================================
### 0. LOGIN - Отримати токен
### =====================================

### Login (заміни email/password на свої)
# @name login
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "warwarwar56@gmail.com",
  "password": "111111"
}

### =====================================
### 1. Organizations Endpoints
### =====================================

### 1.1 Get all organizations for current user
# @name getOrgs
GET {{baseUrl}}/organizations
Authorization: Bearer {{token}}

### 1.2 Create new organization
# @name createOrg
POST {{baseUrl}}/organizations
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "My Organization"
}

### Switch active organization (sets cookie)
POST {{baseUrl}}/organizations/switch
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "organizationId": "{{orgId}}"
}

### Get single organization
GET {{baseUrl}}/organizations/{{orgId}}
Authorization: Bearer {{token}}

### Update organization (owner only)
PATCH {{baseUrl}}/organizations/{{orgId}}
Authorization: Bearer {{token}}
x-org-id: {{orgId}}
Content-Type: application/json

{
  "name": "Updated Organization Name"
}

### Delete organization (owner only)
DELETE {{baseUrl}}/organizations/{{orgId}}
Authorization: Bearer {{token}}
x-org-id: {{orgId}}

### =====================================
### Organization Members Endpoints
### =====================================

### Get organization members
GET {{baseUrl}}/organizations/{{orgId}}/members
Authorization: Bearer {{token}}
x-org-id: {{orgId}}

### Add member to organization (owner/admin only)
POST {{baseUrl}}/organizations/{{orgId}}/members
Authorization: Bearer {{token}}
x-org-id: {{orgId}}
Content-Type: application/json

{
  "email": "warezorwar@gmail.com",
  "role": "member"
}

### Update member role (owner only)
PATCH {{baseUrl}}/organizations/{{orgId}}/members/member-user-uuid
Authorization: Bearer {{token}}
x-org-id: {{orgId}}
Content-Type: application/json

{
  "role": "admin"
}

### Remove member from organization
DELETE {{baseUrl}}/organizations/{{orgId}}/members/member-user-uuid
Authorization: Bearer {{token}}
x-org-id: {{orgId}}

### =====================================
### Org Projects Endpoints
### =====================================

### Get all projects in active organization
GET {{baseUrl}}/org_projects
Authorization: Bearer {{token}}
x-org-id: {{orgId}}

### Create project in active organization
POST {{baseUrl}}/org_projects
Authorization: Bearer {{token}}
x-org-id: {{orgId}}
Content-Type: application/json

{
  "name": "My Project"
}

### Switch active project (sets cookie)
POST {{baseUrl}}/org_projects/switch
Authorization: Bearer {{token}}
x-org-id: {{orgId}}
Content-Type: application/json

{
  "projectId": "4511cf74-044b-4c92-adba-aa57550894c5"
}

### Get single project
GET {{baseUrl}}/org_projects/4511cf74-044b-4c92-adba-aa57550894c5
Authorization: Bearer {{token}}
x-org-id: {{orgId}}

### Update project (project_owner/project_admin only)
PATCH {{baseUrl}}/org_projects/d3b8fafe-3036-4161-9a78-3a24272ab06a
Authorization: Bearer {{token}}
x-org-id: {{orgId}}
x-project-id: d3b8fafe-3036-4161-9a78-3a24272ab06a
Content-Type: application/json

{
  "name": "Updated Project Name"
}

### Delete project (project_owner only)
DELETE {{baseUrl}}/org_projects/{{projectId}}
Authorization: Bearer {{token}}
x-org-id: {{orgId}}
x-project-id: {{projectId}}

### =====================================
### Project Members Endpoints
### =====================================

### Get project members
GET {{baseUrl}}/org_projects/d3b8fafe-3036-4161-9a78-3a24272ab06a/members
Authorization: Bearer {{token}}
x-org-id: {{orgId}}
x-project-id: d3b8fafe-3036-4161-9a78-3a24272ab06a

### Add member to project (project_owner/project_admin only)
POST {{baseUrl}}/org_projects/d3b8fafe-3036-4161-9a78-3a24272ab06a/members
Authorization: Bearer {{token}}
x-org-id: {{orgId}}
x-project-id: d3b8fafe-3036-4161-9a78-3a24272ab06a
Content-Type: application/json

{
  "email": "warezorwar@gmail.com",
  "role": "project_member"
}

### Update project member role (project_owner only)
PATCH {{baseUrl}}/org_projects/d3b8fafe-3036-4161-9a78-3a24272ab06a/members/member-user-uuid
Authorization: Bearer {{token}}
x-org-id: {{orgId}}
x-project-id: d3b8fafe-3036-4161-9a78-3a24272ab06a
Content-Type: application/json

{
  "role": "project_admin"
}

### Remove member from project
DELETE {{baseUrl}}/org_projects/{{projectId}}/members/member-user-uuid
Authorization: Bearer {{token}}
x-org-id: {{orgId}}
x-project-id: {{projectId}}
